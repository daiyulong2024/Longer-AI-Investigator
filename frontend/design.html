<!DOCTYPE html>
<html class="light" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>实验配置中心 - Longer AI Investigator</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#136dec",
                        "background-light": "#f6f7f8",
                        "background-dark": "#101822",
                    },
                    fontFamily: {
                        "display": ["Manrope", "Noto Sans", "sans-serif"]
                    },
                    borderRadius: {"DEFAULT": "0.375rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                },
            },
        }
    </script>
</head>
<body class="bg-background-light dark:bg-background-dark text-[#111418] dark:text-white font-display overflow-hidden">
<div class="flex h-screen w-full bg-background-light dark:bg-background-dark">
    <!-- Sidebar -->
    <div class="w-64 flex-shrink-0 flex flex-col bg-white dark:bg-[#1a202c] border-r border-[#e5e7eb] dark:border-[#2d3748] h-full">
        <div class="p-6 border-b border-[#f0f2f4] dark:border-[#2d3748]">
            <a href="index.html" class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
                    <span class="material-symbols-outlined filled">science</span>
                </div>
                <div>
                    <h1 class="text-base font-bold text-[#111418] dark:text-white leading-tight">Longer AI</h1>
                    <p class="text-xs text-[#617289] dark:text-[#94a3b8] font-medium">Investigator Platform</p>
                </div>
            </a>
        </div>
        <div class="flex-1 overflow-y-auto py-6 px-4 flex flex-col gap-1">
            <a href="#section-persona" class="group flex items-center gap-3 px-3 py-3 rounded-lg bg-primary/10 border-l-4 border-primary cursor-pointer hover:bg-primary/20 transition-colors">
                <span class="material-symbols-outlined filled text-primary">person</span>
                <div class="flex flex-col"><span class="text-sm font-bold">1. 角色设定</span></div>
            </a>
            <div class="ml-6 h-4 border-l border-[#e5e7eb] dark:border-[#4a5568]"></div>
            <a href="#section-scenario" class="group flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 border-l-4 border-transparent cursor-pointer hover:border-gray-300 transition-colors">
                <span class="material-symbols-outlined text-gray-400">landscape</span>
                <div class="flex flex-col"><span class="text-sm font-medium text-gray-500">2. 场景预设</span></div>
            </a>
            <div class="ml-6 h-4 border-l border-[#e5e7eb] dark:border-[#4a5568]"></div>
            <a href="#section-options" class="group flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 border-l-4 border-transparent cursor-pointer hover:border-gray-300 transition-colors">
                <span class="material-symbols-outlined text-gray-400">quiz</span>
                <div class="flex flex-col"><span class="text-sm font-medium text-gray-500">3. 问卷与选项</span></div>
            </a>
            <div class="ml-6 h-4 border-l border-[#e5e7eb] dark:border-[#4a5568]"></div>
            <a href="#section-params" class="group flex items-center gap-3 px-3 py-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 border-l-4 border-transparent cursor-pointer hover:border-gray-300 transition-colors">
                <span class="material-symbols-outlined text-gray-400">tune</span>
                <div class="flex flex-col"><span class="text-sm font-medium text-gray-500">4. 执行参数</span></div>
            </a>
        </div>
    </div>
    <!-- Main Content -->
    <div class="flex-1 flex flex-col h-full overflow-hidden relative">
        <div class="flex-1 overflow-y-auto bg-background-light dark:bg-background-dark pb-32">
            <div class="max-w-[960px] mx-auto px-8 py-10">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h1 class="text-3xl font-extrabold text-[#111418] dark:text-white">实验配置中心</h1>
                        <p class="text-[#617289] dark:text-[#94a3b8] mt-1">Design your social experiment scenario.</p>
                    </div>
                </div>

                <!-- Form -->
                <form id="design-form">
                    <!-- Section 1 -->
                    <section id="section-persona" class="bg-white dark:bg-[#1a202c] rounded-xl shadow-sm border border-[#e5e7eb] mb-6 p-6">
                        <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="material-symbols-outlined text-primary">person</span> 角色设定</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="col-span-1 md:col-span-2">
                                <label class="block text-sm font-medium mb-2">实验名称</label>
                                <input name="experimentName" class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-primary/20" placeholder="为本次实验起个名字" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">角色名称</label>
                                <input name="personaName" class="w-full px-4 py-3 rounded-lg border border-gray-200 focus:ring-2 focus:ring-primary/20" placeholder="例如：中学生" value="中学生"/>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">行为逻辑</label>
                                <select name="behaviorLogic" class="w-full px-4 py-3 rounded-lg border border-gray-200">
                                    <option>理性分析</option>
                                    <option>情感驱动</option>
                                    <option>随机游走</option>
                                    <option>从众心理</option>
                                </select>
                            </div>
                            <div class="col-span-2">
                                <label class="block text-sm font-medium mb-2">背景故事</label>
                                <textarea name="backgroundStory" class="w-full px-4 py-3 rounded-lg border border-gray-200 min-h-[100px]" placeholder="描述角色背景...">一名普通的高中二年级学生，面临高考压力，性格内向，害怕由自己做决定。</textarea>
                            </div>
                        </div>
                    </section>

                    <!-- Section 2 -->
                    <section id="section-scenario" class="bg-white dark:bg-[#1a202c] rounded-xl shadow-sm border border-[#e5e7eb] mb-6 p-6">
                        <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="material-symbols-outlined text-purple-600">landscape</span> 场景预设</h2>
                        <textarea name="scenarioDescription" class="w-full px-4 py-3 rounded-lg border border-gray-200 min-h-[150px]" placeholder="描述场景...">你是学校里的一名学生。今天数学考试你不小心作弊被发现了，老师让你放学后去办公室。你现在非常害怕。</textarea>
                    </section>
                    
                    <!-- Section 3 -->
                    <section id="section-options" class="bg-white dark:bg-[#1a202c] rounded-xl shadow-sm border border-[#e5e7eb] mb-6 p-6">
                        <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="material-symbols-outlined text-orange-600">quiz</span> 问卷与选项</h2>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">核心问题</label>
                            <input name="coreQuestion" class="w-full px-4 py-3 rounded-lg border border-gray-200" placeholder="例如：你会怎么做？" value="放学后，你会怎么做？"/>
                        </div>
                        <div id="options-container" class="flex flex-col gap-3">
                            <!-- Options will be here -->
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center font-bold text-slate-500">A</div>
                                <input name="option_A" class="flex-1 px-4 py-2 rounded-lg border border-gray-200" value="直接去办公室认错"/>
                            </div>
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center font-bold text-slate-500">B</div>
                                <input name="option_B" class="flex-1 px-4 py-2 rounded-lg border border-gray-200" value="逃跑，假装生病回家"/>
                            </div>
                             <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center font-bold text-slate-500">C</div>
                                <input name="option_C" class="flex-1 px-4 py-2 rounded-lg border border-gray-200" value="找好朋友商量对策"/>
                            </div>
                        </div>
                    </section>

                    <!-- Section 4 -->
                    <section id="section-params" class="bg-white dark:bg-[#1a202c] rounded-xl shadow-sm border border-[#e5e7eb] mb-6 p-6">
                        <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><span class="material-symbols-outlined text-teal-600">tune</span> 执行参数</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <div class="flex justify-between mb-2">
                                    <label class="block text-sm font-medium">AI 实例数量</label>
                                    <span class="text-primary font-bold" id="instance-count-display">50</span>
                                </div>
                                <input name="instanceCount" type="range" min="1" max="500" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary" oninput="document.getElementById('instance-count-display').innerText = this.value"/>
                            </div>
                            <div class="flex items-center justify-between">
                                <div>
                                    <span class="font-medium">并行执行</span>
                                    <p class="text-xs text-gray-500">加快速度</p>
                                </div>
                                <input name="isParallel" type="checkbox" checked class="w-6 h-6 text-primary rounded focus:ring-primary"/>
                            </div>
                        </div>
                    </section>
                </form>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="absolute bottom-0 w-full bg-white dark:bg-[#1a202c] border-t border-[#e5e7eb] px-8 py-4 z-10 flex justify-between items-center shadow-lg">
             <div class="text-sm text-gray-500">Ready to run simulation.</div>
             <button onclick="handleRun()" class="px-6 py-3 rounded-lg bg-primary text-white font-bold hover:bg-blue-700 shadow-lg flex items-center gap-2">
                <span class="material-symbols-outlined">play_arrow</span> 运行实验
            </button>
        </div>
    </div>
</div>
<script src="js/app.js"></script>
<script>
    function handleRun() {
        const form = document.getElementById('design-form');
        const formData = new FormData(form);
        const config = {};
        
        // Manual extraction because FormData structure varies
        config.experimentName = form.querySelector('[name=experimentName]').value;
        config.personaName = form.querySelector('[name=personaName]').value;
        config.behaviorLogic = form.querySelector('[name=behaviorLogic]').value;
        config.backgroundStory = form.querySelector('[name=backgroundStory]').value;
        config.scenarioDescription = form.querySelector('[name=scenarioDescription]').value;
        config.coreQuestion = form.querySelector('[name=coreQuestion]').value;
        config.instanceCount = form.querySelector('[name=instanceCount]').value;
        config.isParallel = form.querySelector('[name=isParallel]').checked;
        
        // Extract Options
        config.options = [];
        const optionInputs = form.querySelectorAll('input[name^="option_"]');
        optionInputs.forEach(input => {
             if(input.value.trim()) {
                 config.options.push({
                     key: input.name.split('_')[1],
                     text: input.value
                 });
             }
        });
        
        if(config.options.length < 2) {
            alert("请至少设置两个选项");
            return;
        }

        const expId = createExperiment(config);
        window.location.href = `monitor.html?id=${expId}`;
    }
</script>
</body>
</html>
